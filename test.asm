;0020080001
;0201009020
;8001101040
asm
ORG 0x03ED
MASK: WORD 0x00FF
test_2_data:WORD 0xA233; =1010 0010 0011 0011 -> 1101 0001 0001 1001 = D119
test_2_res: WORD 0xD119
test_7_data:WORD 0x9DCF; =1010 0010 0011 0011 -> 1101 0001 0001 1001 = D119
test_7_res: WORD 0xCEE7
RES_ADDR: WORD $RES
RES: WORD 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0; 6 тестов



START:
CLA



LD #0x1A   ;0011 0100 -> 0001 1010 = 1A
PUSH
LD #0x34
PUSH
CALL MULTY_TEST

LD test_2_res   
PUSH
LD test_2_data
PUSH
CALL MULTY_TEST

CLA
PUSH
PUSH
CALL MULTY_TEST

LD #0xFF
PUSH
PUSH
CALL MULTY_TEST

LD test_7_res   
PUSH
LD test_7_data
PUSH
CALL MULTY_TEST

HLT

;(DATA, RES)
MULTY_TEST:

LD &0x2
PUSH
LD &0x2
PUSH
CALL TEST_RES

LD &0x1
PUSH
CALL TEST_SAVE_NZVC

LD &0x1
PUSH
CALL TEST_SAVE_AC

SWAP
ST &0x2
SWAP

SWAP
POP
SWAP
POP
RET

;(DATA, RES)
TEST_RES: LD &0x1
ST M
CALL COMMAND
LD M
CMP &0x2
BEQ PASSED_TEST1
LD #0x0
JUMP END_TEST1
PASSED_TEST1: LD #0x1
END_TEST1: PUSH
CALL WRITE_RES
SWAP
ST &0x2
SWAP
SWAP
POP
SWAP
POP
RET

TEST_SAVE_NZVC:
LD &0x1
ST M

PUSHF	;PUSH FLAGS

CALL COMMAND
PUSHF	;GET FLAGS
POP
CMP &0x0
BEQ PASSED_TEST2
LD #0x0
JUMP END_TEST2
PASSED_TEST2: LD #0x1
END_TEST2: PUSH
CALL WRITE_RES

SWAP
POP
SWAP
ST &0x1
SWAP
SWAP
POP
RET

TEST_SAVE_AC:
LD &0x1
ST M
PUSH
CALL COMMAND
CMP &0x0
BEQ PASSED_TEST3
LD #0x0
JUMP END_TEST3
PASSED_TEST3: LD #0x1
END_TEST3: PUSH
CALL WRITE_RES
SWAP
POP
SWAP
ST &0x1
SWAP

SWAP
POP
RET

WRITE_RES:
LD &0x1
ST (RES_ADDR)+
SWAP
ST &0x1
SWAP

SWAP
POP
RET

M: WORD 0x8
COMMAND:
WORD 0x9EFE ;MyCommand M
;cmc
;LD #0xFF
RET

;>>> def g(a):
;...     s = bin(int(a, 16)>>1)[2:]
;...     s = "0"*(4-len(s)%4)+s
;...     return [s[i:i+4] for i in range(0, len(s), 4)]

END

